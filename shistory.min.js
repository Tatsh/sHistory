/* sHistory (c) 2012 Andrew Udvare | http://www.opensource.org/licenses/mit-license.php */
(function(){var h=void 0,j=!0,k=null,l=!1;function m(){if(!o){var b=function(a){a=a||location.href;return"#"+a.replace(/^[^#]*#(.*)$/,"$1")},c=document.createElement("iframe");c.setAttribute("tabindex",-1);c.setAttribute("title","empty");c.setAttribute("src","javascript:0");c.setAttribute("id","shistory");c.style.display="none";var d=b(),e=function(a){return a},a=e,g=e,f=function(){for(var a=0;a<p.length;a++)p[a]()},n=function(){var c=b(),e=a();c!==d?(d=c,g(d,e),f()):e!==d&&(location.href=location.href.replace(/#.*/,"")+e);setTimeout(n,50)},i=function(){var d=c.contentWindow;a=function(){return b(d.location.href)};g=function(a,b){if(a!==b){var c=d.document;c.open();c.close();d.location.hash=a}};d.document.open();d.location.hash=location.hash;n();f();c.detachEvent?c.detachEvent("onload",i):c.removeEventListener&&c.removeEventListener("load",i)};c.attachEvent?c.attachEvent("onload",i):c.addEventListener&&c.addEventListener("load",i,l);document.body.appendChild(c)}return this}var o,q=document.documentMode;o="onhashchange"in window&&(q===h||7<q);function r(){var b=location.protocol+"//"+location.hostname,c=location.search?location.search.substr(1):"";c&&(b+="?"+c);return b}function s(b,c,d){d===h&&(d=j);if(!(b===h||c===h||"__t"===b)){var e=r(),a=location.hash.replace(/^#&/,"#"),g=encodeURIComponent;a||(a="#");if(d)if(t(b)!==k){for(var d=a.substr(1).split("&"),f=0;f<d.length;f++)a=d[f].split("="),a[0]===b&&(d[f]=b+"="+g(c.toString()));a="#"+d.join("&")}else location.hash&&(a+="&"),a+=b+"="+g(c.toString());else a="#"+b+"="+g(c.toString());location.href=e+a}}function t(b,c){if(!b||"__t"===b)return k;c===h&&(c="string");for(var d=location.hash.substr(1).split("&"),e,a=k,g=k,f=0;f<d.length;f++)if(e=d[f].split("="),e[0]===b){a=decodeURIComponent(e[1]);g=a.toLowerCase();break}if("string"!==c)switch(c){case "number":case "integer":case "int":a=parseInt(a,10);isNaN(a)&&(a=0);break;case "float":a=parseFloat(a);break;case "boolean":case "bool":a="true"===g?j:"false"===g?l:!!a}return a}var u=l,p=[];window.sHistory=m;window.sHistory.start=function(b,c){if(!u){if(b!==h&&c!==h&&t(b)===k)o||m(),s(b,c);else{var d;if(o)if(document.createEvent)d=document.createEvent("HTMLEvents"),d.initEvent("hashchange",j,l),window.dispatchEvent(d);else{d=location.hash;if(""!==d){d=d.replace(/[\&\#]__t=[0-9]+\&?/,"");for(var e="",a=0;10>a;a++)e+="0123456789".charAt(Math.floor(9*Math.random()));d+="&__t="+e}location.hash=d}else m()}u=j}};window.sHistory.addEventListener=function(b){o?window.addEventListener("hashchange",b,l):p.push(b)};window.sHistory.getState=t;window.sHistory.hasNativeSupport=o;window.sHistory.pushState=s;window.sHistory.pushStates=function(b,c){c===h&&(c=j);b===h&&(b={});var d=encodeURIComponent,e=r(),a,g="#";location.hash||(c=l);if(c){var f=location.hash.substr(1).split("&"),n;for(a in b)if(b.hasOwnProperty(a))if(t(a)!==k)for(var i=0;i<f.length;i++)n=f[i].split("="),n[0]===a&&(b[a]===j?b[a]="true":b[a]===l&&(b[a]="false"),f[i]=a+"="+d(b[a]));else f.push(a+"="+d(b[a]));g+=f.join("&")}else for(a in b)"__t"!==a&&b.hasOwnProperty(a)&&(b[a]===j?b[a]="true":b[a]===l&&(b[a]="false"),g+=a+"="+d(b[a]));location.href=e+g};window.sHistory.removeState=function(b){b===h&&(location.href=r()+"#")};}())